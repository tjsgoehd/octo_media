<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì˜¥íŠœë¸Œ - ì•„ì¹´ì´ë¸Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; letter-spacing: -0.025em; }
        
        /* ë¹„ë””ì˜¤ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .video-card { background: white; border-radius: 20px; overflow: hidden; transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); cursor: pointer; border: 1px solid #f1f5f9; }
        .video-card:hover { transform: translateY(-6px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); border-color: #e2e8f0; }
        
        /* ì¸ë„¤ì¼ ë‚´ë¶€ ì‘ì„±ì ë°°ì§€ */
        .author-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background-color: #ff5a5a;
            color: white;
            padding: 5px 14px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 700;
            z-index: 10;
            box-shadow: 0 6px 12px rgba(255, 90, 90, 0.4);
            border: 1.5px solid rgba(255, 255, 255, 0.3);
        }

        /* ì¹´í…Œê³ ë¦¬ ìŠ¤íƒ€ì¼ */
        .category-text {
            color: #2563eb;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 4px;
            display: inline-block;
        }

        /* ì œëª© ìŠ¤íƒ€ì¼: ìš”ì²­ì— ë”°ë¼ í¬ê¸°ë¥¼ 1.35rem -> 1.15remìœ¼ë¡œ ì¶•ì†Œ */
        .video-title {
            font-size: 1.15rem;
            font-weight: 800;
            color: #0f172a;
            line-height: 1.35;
            letter-spacing: -0.03em;
        }

        /* ì¸ë„¤ì¼ ì„ íƒ ìŠ¤íƒ€ì¼ */
        .thumb-option { border: 4px solid transparent; border-radius: 14px; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden; }
        .thumb-option.selected { border-color: #2563eb; transform: scale(1.05); z-index: 10; }
        
        #player-modal, #admin-modal, #loading-overlay { backdrop-filter: blur(20px); background-color: rgba(0, 0, 0, 0.85); }
        .admin-badge { display: none; }
        body.is-admin .admin-badge { display: flex; }
        body.is-admin .login-btn { display: none; }
        
        .filter-btn { transition: all 0.2s; background: white; color: #64748b; border: 1px solid #f1f5f9; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .filter-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2); }

        .wide-search-container { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            border: 2px solid transparent; 
            background-color: #f1f5f9;
        }
        .wide-search-container:focus-within { 
            background-color: white;
            border-color: #2563eb; 
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.1);
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="text-slate-900">

    <header class="sticky top-0 z-[100] bg-white/80 backdrop-blur-md border-b border-slate-100">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2.5 cursor-pointer" onclick="location.reload()">
                <div class="w-9 h-9 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-md shadow-blue-200">
                    <i data-lucide="play" fill="white" class="w-4 h-4 ml-0.5"></i>
                </div>
                <span class="font-extrabold text-xl tracking-tighter text-slate-900">ì˜¥íŠœë¸Œ</span>
            </div>
            <div class="flex items-center gap-3">
                <div class="admin-badge items-center gap-2 bg-blue-50 text-blue-700 px-4 py-2 rounded-full text-[11px] font-bold border border-blue-100">
                    <span class="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse"></span>
                    ADMIN
                </div>
                <button onclick="requestToken()" class="login-btn bg-slate-100 text-slate-600 px-5 py-2.5 rounded-full text-xs font-bold hover:bg-slate-200 transition-colors">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
                <button onclick="openAdmin()" class="bg-blue-600 text-white px-5 py-2.5 rounded-full text-xs font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-100">ì˜ìƒ ë“±ë¡</button>
            </div>
        </div>
    </header>

    <!-- ê²€ìƒ‰ ë° í•„í„° ì„¹ì…˜ -->
    <section class="bg-white">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto text-center space-y-6">
                <div class="space-y-2">
                    <h1 class="text-2xl font-extrabold flex items-center justify-center gap-2">
                        ğŸ”¥ ì§€ê¸ˆ ê°€ì¥ í•«í•œ ì½˜í…ì¸ 
                    </h1>
                    <p class="text-slate-400 font-medium text-sm">ì•„ì¹´ì´ë¸Œì˜ ìµœì‹  ì˜ìƒì„ í™•ì¸í•˜ì„¸ìš”.</p>
                </div>

                <div class="relative group">
                    <div class="wide-search-container flex items-center rounded-2xl px-6 py-4">
                        <i data-lucide="search" class="w-5 h-5 text-slate-400 group-focus-within:text-blue-600 transition-colors"></i>
                        <input 
                            type="text" 
                            id="video-search" 
                            oninput="handleSearch(this.value)"
                            placeholder="ì°¾ê³  ìˆëŠ” ê³µëµì´ë‚˜ ì˜ìƒì„ ì…ë ¥í•˜ì„¸ìš”" 
                            class="bg-transparent border-none outline-none ml-3 w-full text-base md:text-lg font-semibold text-slate-800 placeholder-slate-400"
                        >
                    </div>
                </div>

                <div id="category-filters" class="flex flex-wrap justify-center gap-2">
                    <button onclick="filterVideos('ì „ì²´')" class="filter-btn active px-6 py-2 rounded-full text-sm font-bold">ì „ì²´</button>
                    <button onclick="filterVideos('ë‹¨ê¸°ì»·')" class="filter-btn px-6 py-2 rounded-full text-sm font-bold">ë‹¨ê¸°ì»·</button>
                    <button onclick="filterVideos('ê³µëµ')" class="filter-btn px-6 py-2 rounded-full text-sm font-bold">ê³µëµ</button>
                    <button onclick="filterVideos('ê°€ì´ë“œ')" class="filter-btn px-6 py-2 rounded-full text-sm font-bold">ê°€ì´ë“œ</button>
                    <button onclick="filterVideos('ê¸°íƒ€')" class="filter-btn px-6 py-2 rounded-full text-sm font-bold">ê¸°íƒ€</button>
                </div>
            </div>
        </div>
    </section>

    <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
    <main class="max-w-7xl mx-auto px-4 pb-20 pt-4">
        <div class="flex items-center justify-between mb-8 border-b border-slate-100 pb-4">
            <div class="flex items-center gap-2 font-extrabold text-lg text-slate-800">
                <i data-lucide="layout-grid" class="w-5 h-5 text-blue-600"></i>
                ì½˜í…ì¸  ì•„ì¹´ì´ë¸Œ
            </div>
            <span id="video-count" class="text-slate-400 text-xs font-bold">ì´ 0ê°œ</span>
        </div>

        <div id="video-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 md:gap-7">
            <!-- ì˜ìƒ ëª©ë¡ ë¡œë“œ ì˜ì—­ -->
        </div>
    </main>

    <!-- ì—…ë¡œë“œ/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="admin-modal" class="fixed inset-0 z-[1100] hidden items-center justify-center p-4">
        <div class="bg-white w-full max-w-xl rounded-[40px] p-8 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center mb-8">
                <h2 id="modal-title" class="text-2xl font-extrabold tracking-tight">ìƒˆ ì˜ìƒ ì—…ë¡œë“œ</h2>
                <button onclick="closeAdmin()" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 text-slate-400 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div id="upload-step-1" class="space-y-4">
                <div class="border-3 border-dashed border-slate-200 rounded-[32px] p-16 text-center hover:border-blue-500 hover:bg-blue-50/30 transition-all group">
                    <input type="file" id="video-input" accept="video/*" class="hidden" onchange="handleFileSelect(event)">
                    <label for="video-input" class="cursor-pointer block">
                        <div class="w-20 h-20 bg-blue-50 text-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-5 group-hover:scale-110 transition-transform">
                            <i data-lucide="upload-cloud" class="w-10 h-10"></i>
                        </div>
                        <p class="text-slate-700 font-extrabold text-lg">ì˜ìƒ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</p>
                    </label>
                </div>
            </div>

            <div id="upload-step-2" class="hidden space-y-6">
                <div class="text-center">
                    <p id="step-2-guide" class="text-blue-600 font-bold mb-6 text-sm italic">ì¸ë„¤ì¼ì„ ì„ íƒí•˜ê³  ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                    <div id="thumbnail-container" class="grid grid-cols-5 gap-2 mb-8"></div>
                    <div class="space-y-4 text-left">
                        <input id="input-title" type="text" placeholder="ì˜ìƒ ì œëª©" class="w-full px-6 py-4 bg-slate-50 border-none rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 font-bold text-lg">
                        <div class="grid grid-cols-2 gap-4">
                            <select id="input-category" class="w-full px-6 py-4 bg-slate-50 border-none rounded-2xl outline-none font-bold cursor-pointer">
                                <option value="ë‹¨ê¸°ì»·">ë‹¨ê¸°ì»·</option>
                                <option value="ê³µëµ">ê³µëµ</option>
                                <option value="ê°€ì´ë“œ">ê°€ì´ë“œ</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                            <input id="input-author" type="text" placeholder="ì‘ì„±ì" class="w-full px-6 py-4 bg-slate-50 border-none rounded-2xl outline-none font-bold">
                        </div>
                    </div>
                    <button id="final-action-btn" onclick="handleFinalAction()" class="w-full py-5 bg-blue-600 text-white font-extrabold rounded-2xl mt-8 shadow-xl shadow-blue-200 hover:bg-blue-700 transition-all text-lg">
                        êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—…ë¡œë“œ ë° ë“±ë¡
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loading-overlay" class="fixed inset-0 z-[2000] hidden flex-col items-center justify-center text-white">
        <div class="w-14 h-14 border-4 border-blue-600/30 border-t-blue-600 rounded-full animate-spin mb-6"></div>
        <p id="loading-text" class="font-extrabold text-xl"></p>
    </div>

    <!-- í”Œë ˆì´ì–´ ëª¨ë‹¬ -->
    <div id="player-modal" class="fixed inset-0 z-[1000] hidden flex-col items-center justify-center p-4" onclick="closePlayer()">
        <div class="w-full max-w-5xl" onclick="event.stopPropagation()">
            <div id="video-frame" class="bg-black rounded-[32px] overflow-hidden aspect-video shadow-2xl relative border border-white/10">
                <div id="iframe-loader" class="absolute inset-0 z-0 loading-skeleton flex flex-col items-center justify-center">
                    <div class="w-10 h-10 border-3 border-white/20 border-t-white/80 rounded-full animate-spin"></div>
                </div>
            </div>
            <div class="mt-8 flex justify-center gap-4">
                <button onclick="closePlayer()" class="text-white bg-white/10 px-8 py-3 rounded-full font-bold hover:bg-white/20 transition-colors backdrop-blur-md">ë‹«ê¸°</button>
                <div class="admin-badge items-center gap-4">
                    <button onclick="openEditMode()" class="text-blue-400 bg-blue-400/10 px-8 py-3 rounded-full font-bold hover:bg-blue-400/20 transition-colors backdrop-blur-md">ì •ë³´ ìˆ˜ì •</button>
                    <button onclick="deleteVideo()" class="text-rose-500 bg-rose-500/10 px-8 py-3 rounded-full font-bold hover:bg-rose-500/20 transition-colors backdrop-blur-md">ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const CLIENT_ID = '131660349524-lfu2c56t4ent6167fu68essbleoquptp.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        const firebaseConfig = {
            apiKey: "AIzaSyAjbApqAPhrZXcnR2P_xd-nvrZOvZp67CI",
            authDomain: "octopath-85851.firebaseapp.com",
            projectId: "octopath-85851",
            storageBucket: "octopath-85851.firebasestorage.app",
            messagingSenderId: "744016190979",
            appId: "1:744016190979:web:fbc5badeda2e24f5f47836"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const targetCollection = collection(db, 'artifacts', 'octopath-85851', 'public', 'data', 'videos');

        let selectedFile, selectedThumb, tokenClient, accessToken;
        let currentEditingVideo = null; 
        let allVideos = [];
        let currentFilter = 'ì „ì²´';
        let searchQuery = '';

        window.onload = async () => {
            try {
                await signInAnonymously(auth);
                loadVideos();
                initGoogleAuth();
                const savedToken = sessionStorage.getItem('gdrive_token');
                if (savedToken) {
                    accessToken = savedToken;
                    document.body.classList.add('is-admin');
                }
            } catch (e) { console.error(e); }
        };

        function initGoogleAuth() {
            if (typeof google !== 'undefined') {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID, scope: SCOPES,
                    callback: (resp) => {
                        if (resp.error) return;
                        accessToken = resp.access_token;
                        sessionStorage.setItem('gdrive_token', accessToken);
                        document.body.classList.add('is-admin');
                        if (document.getElementById('admin-modal').classList.contains('flex') && selectedFile) startProcess();
                    },
                });
            }
        }

        function loadVideos() {
            onSnapshot(targetCollection, (snap) => {
                allVideos = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }))
                                    .sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                renderVideos();
            }, (error) => console.error(error));
        }

        window.handleSearch = (val) => {
            searchQuery = val.toLowerCase().trim();
            renderVideos();
        };

        window.filterVideos = (cat) => {
            currentFilter = cat;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.toggle('active', btn.innerText === cat));
            renderVideos();
        };

        function renderVideos() {
            const grid = document.getElementById('video-grid');
            const filtered = allVideos.filter(v => (currentFilter === 'ì „ì²´' || v.category === currentFilter) && 
                (v.title.toLowerCase().includes(searchQuery) || (v.author && v.author.toLowerCase().includes(searchQuery))));

            document.getElementById('video-count').innerText = `ì´ ${filtered.length}ê°œ`;

            if (filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-20 text-center text-slate-300 font-bold">ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            } else {
                grid.innerHTML = filtered.map(v => `
                    <div class="video-card" onclick="openPlayer('${v.fileId}', '${v.id}', ${JSON.stringify(v).replace(/"/g, '&quot;')})">
                        <div class="aspect-video bg-slate-100 relative">
                            <div class="author-badge">
                                <i data-lucide="user" class="w-3.5 h-3.5" fill="white"></i>
                                <span>${v.author || 'ìµëª…'}</span>
                            </div>
                            <img src="${v.thumbnail}" class="w-full h-full object-cover">
                        </div>
                        <div class="p-5">
                            <span class="category-text">${v.category}</span>
                            <h3 class="video-title line-clamp-2">${v.title}</h3>
                        </div>
                    </div>
                `).join('');
            }
            lucide.createIcons();
        }

        window.handleFileSelect = async (e) => {
            selectedFile = e.target.files[0];
            if (!selectedFile) return;
            showLoading("ì¸ë„¤ì¼ ì¶”ì¶œ ì¤‘...");
            const videoUrl = URL.createObjectURL(selectedFile);
            const video = document.createElement('video');
            video.src = videoUrl; video.muted = true;
            video.onloadedmetadata = async () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const thumbs = [];
                for (let t of [0.1, 0.3, 0.5, 0.7, 0.9]) {
                    video.currentTime = t * video.duration;
                    await new Promise(r => {
                        const seeked = () => { video.removeEventListener('seeked', seeked); setTimeout(r, 800); };
                        video.addEventListener('seeked', seeked);
                    });
                    canvas.width = 640; canvas.height = 360;
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    thumbs.push(canvas.toDataURL('image/jpeg', 0.8));
                }
                document.getElementById('upload-step-1').classList.add('hidden');
                document.getElementById('upload-step-2').classList.remove('hidden');
                document.getElementById('thumbnail-container').innerHTML = thumbs.map((src, i) => `
                    <div class="thumb-option ${i===2?'selected':''}" onclick="selectThumb(this, '${src}')">
                        <img src="${src}" class="w-full aspect-video object-cover rounded-lg">
                    </div>
                `).join('');
                selectedThumb = thumbs[2]; hideLoading(); URL.revokeObjectURL(videoUrl);
            };
        };

        window.selectThumb = (el, src) => {
            document.querySelectorAll('.thumb-option').forEach(t => t.classList.remove('selected'));
            el.classList.add('selected'); selectedThumb = src;
        };

        window.handleFinalAction = () => {
            if (!selectedThumb || !document.getElementById('input-title').value) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if (currentEditingVideo) updateExistingVideo(); else startProcessWithCheck();
        };

        window.startProcessWithCheck = () => { if (accessToken) startProcess(); else tokenClient.requestAccessToken({ prompt: '' }); };
        window.requestToken = () => { tokenClient.requestAccessToken({ prompt: 'select_account' }); };

        async function startProcess() {
            showLoading("íŒŒì¼ ì—…ë¡œë“œ ì¤‘...");
            try {
                const folderId = await findOrCreateFolder('octo_media');
                const fileId = await uploadFile(folderId);
                await addDoc(targetCollection, {
                    fileId, thumbnail: selectedThumb,
                    title: document.getElementById('input-title').value,
                    category: document.getElementById('input-category').value,
                    author: document.getElementById('input-author').value || 'ìµëª…',
                    timestamp: serverTimestamp()
                });
                location.reload();
            } catch (err) { alert("ì˜¤ë¥˜: " + err.message); hideLoading(); }
        }

        async function updateExistingVideo() {
            showLoading("ì •ë³´ ìˆ˜ì • ì¤‘...");
            try {
                await updateDoc(doc(db, 'artifacts', 'octopath-85851', 'public', 'data', 'videos', currentEditingVideo.id), {
                    title: document.getElementById('input-title').value,
                    category: document.getElementById('input-category').value,
                    author: document.getElementById('input-author').value || 'ìµëª…',
                    thumbnail: selectedThumb
                });
                location.reload();
            } catch (e) { alert("ì˜¤ë¥˜: " + e.message); hideLoading(); }
        }

        async function findOrCreateFolder(name) {
            const q = encodeURIComponent(`name = '${name}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`);
            const res = await fetch(`https://www.googleapis.com/drive/v3/files?q=${q}`, { headers: { 'Authorization': `Bearer ${accessToken}` } });
            const data = await res.json();
            if (data.files?.length > 0) return data.files[0].id;
            const cr = await fetch('https://www.googleapis.com/drive/v3/files', {
                method: 'POST', headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, mimeType: 'application/vnd.google-apps.folder' })
            });
            return (await cr.json()).id;
        }

        async function uploadFile(folderId) {
            const res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable', {
                method: 'POST', headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: selectedFile.name, parents: [folderId] })
            });
            const uploadUrl = res.headers.get('Location');
            const xhr = new XMLHttpRequest();
            xhr.open('PUT', uploadUrl, false); xhr.send(selectedFile);
            return JSON.parse(xhr.response).id;
        }

        window.openPlayer = (fileId, docId, videoData) => {
            currentEditingVideo = { id: docId, ...videoData };
            const frame = document.getElementById('video-frame');
            document.getElementById('iframe-loader').style.display = 'flex';
            const ifr = document.createElement('iframe');
            ifr.src = `https://drive.google.com/file/d/${fileId}/preview`;
            ifr.className = "w-full h-full relative z-10";
            ifr.onload = () => document.getElementById('iframe-loader').style.display = 'none';
            frame.appendChild(ifr);
            document.getElementById('player-modal').classList.replace('hidden', 'flex');
        };

        window.closePlayer = () => {
            const frame = document.getElementById('video-frame');
            frame.querySelectorAll('iframe').forEach(f => f.remove());
            document.getElementById('player-modal').classList.replace('flex', 'hidden');
        };

        window.openEditMode = () => {
            document.getElementById('modal-title').innerText = "ì •ë³´ ìˆ˜ì •";
            document.getElementById('upload-step-1').classList.add('hidden');
            document.getElementById('upload-step-2').classList.remove('hidden');
            document.getElementById('input-title').value = currentEditingVideo.title;
            document.getElementById('input-category').value = currentEditingVideo.category;
            document.getElementById('input-author').value = currentEditingVideo.author;
            selectedThumb = currentEditingVideo.thumbnail;
            document.getElementById('thumbnail-container').innerHTML = `<div class="thumb-option selected col-span-2"><img src="${selectedThumb}" class="w-full rounded-lg"></div>`;
            document.getElementById('admin-modal').classList.replace('hidden', 'flex');
        };

        window.deleteVideo = async () => {
            if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            showLoading("ì‚­ì œ ì¤‘...");
            try {
                if (accessToken) await fetch(`https://www.googleapis.com/drive/v3/files/${currentEditingVideo.fileId}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${accessToken}` } });
                await deleteDoc(doc(db, 'artifacts', 'octopath-85851', 'public', 'data', 'videos', currentEditingVideo.id));
                location.reload();
            } catch (e) { alert("ì‚­ì œ ì‹¤íŒ¨"); hideLoading(); }
        };

        window.openAdmin = () => {
            currentEditingVideo = null;
            document.getElementById('modal-title').innerText = "ìƒˆ ì˜ìƒ ì—…ë¡œë“œ";
            document.getElementById('upload-step-1').classList.remove('hidden');
            document.getElementById('upload-step-2').classList.add('hidden');
            document.getElementById('admin-modal').classList.replace('hidden', 'flex');
        };
        window.closeAdmin = () => document.getElementById('admin-modal').classList.replace('flex', 'hidden');
        function showLoading(t) { document.getElementById('loading-text').innerText = t; document.getElementById('loading-overlay').classList.replace('hidden', 'flex'); }
        function hideLoading() { document.getElementById('loading-overlay').classList.replace('flex', 'hidden'); }
    </script>
</body>
</html>
