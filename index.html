<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OKTUBE | í”„ë¦¬ë¯¸ì—„ ì•„ì¹´ì´ë¸Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: #0f172a; /* ë‹¤í¬ ëª¨ë“œ ë°°ê²½ìœ¼ë¡œ ë³€ê²½ (ì˜ìƒ ì§‘ì¤‘ë„) */
            color: #f8fafc;
            letter-spacing: -0.025em; 
        }

        .glass-header { 
            backdrop-filter: blur(20px); 
            background: rgba(15, 23, 42, 0.8); 
            border-bottom: 1px solid rgba(255,255,255,0.05); 
        }

        .video-card { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .video-card:hover {
            transform: translateY(-4px);
            border-color: #3b82f6;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .cat-btn {
            background: #334155;
            color: #94a3b8;
            transition: all 0.2s;
        }
        .cat-btn.active {
            background: #2563eb;
            color: white;
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.4);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .shimmer {
            background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* ëª¨ë°”ì¼ ìµœì í™” ê·¸ë¦¬ë“œ */
        @media (max-width: 640px) {
            .video-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Header -->
    <header class="sticky top-0 z-[60] glass-header px-4 md:px-12 h-16 md:h-20 flex items-center justify-between">
        <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
            <div class="w-8 h-8 md:w-10 md:h-10 bg-blue-600 rounded-lg md:rounded-xl flex items-center justify-center text-white shadow-lg">
                <i data-lucide="play" fill="currentColor" class="w-4 h-4 md:w-5 md:h-5 ml-0.5"></i>
            </div>
            <span class="font-bold text-lg md:text-xl tracking-tight">ì˜¥íŠœë¸Œ</span>
        </div>
        
        <div class="flex items-center gap-2">
            <button id="admin-mode-btn" onclick="openAdminLogin()" class="flex items-center gap-1.5 bg-white/5 hover:bg-white/10 text-white px-4 py-2 rounded-full text-xs md:text-sm font-semibold transition-all border border-white/10">
                <i data-lucide="lock" class="w-3.5 h-3.5"></i>
                <span id="admin-status-text">ê´€ë¦¬ì</span>
            </button>
        </div>
    </header>

    <main class="max-w-[1400px] mx-auto px-4 md:px-12 py-6 md:py-10">
        <section class="mb-8">
            <div class="flex items-center gap-2 mb-2">
                <span class="text-xl md:text-2xl animate-bounce">ğŸ”¥</span>
                <h1 class="text-xl md:text-3xl font-extrabold tracking-tight">ì‹¤ì‹œê°„ ì•„ì¹´ì´ë¸Œ</h1>
            </div>
            <p class="text-slate-400 text-xs md:text-base">êµ¬ê¸€ ë“œë¼ì´ë¸Œì™€ ì—°ë™ëœ ëŠê¹€ ì—†ëŠ” ì˜ìƒ ì €ì¥ì†Œ</p>
        </section>

        <!-- Category Nav -->
        <nav class="flex gap-2 overflow-x-auto pb-6 mb-2 no-scrollbar">
            <button onclick="filterCat('ì „ì²´')" class="cat-btn active whitespace-nowrap px-6 py-2.5 rounded-full text-xs md:text-sm font-bold shadow-sm">ì „ì²´</button>
            <button onclick="filterCat('ë‹¨ê¸°ì»·')" class="cat-btn whitespace-nowrap px-6 py-2.5 rounded-full text-xs md:text-sm font-bold shadow-sm">ë‹¨ê¸°ì»·</button>
            <button onclick="filterCat('ê³µëµ')" class="cat-btn whitespace-nowrap px-6 py-2.5 rounded-full text-xs md:text-sm font-bold shadow-sm">ê³µëµ</button>
            <button onclick="filterCat('ê¸°íƒ€')" class="cat-btn whitespace-nowrap px-6 py-2.5 rounded-full text-xs md:text-sm font-bold shadow-sm">ê¸°íƒ€</button>
        </nav>

        <!-- Video Grid -->
        <div id="video-grid" class="video-grid grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-x-6 md:gap-y-10">
            <!-- Loading States -->
            <div class="shimmer rounded-3xl aspect-video"></div>
            <div class="shimmer rounded-3xl aspect-video"></div>
            <div class="shimmer rounded-3xl aspect-video"></div>
            <div class="shimmer rounded-3xl aspect-video"></div>
        </div>
    </main>

    <!-- Admin Logic: Simple Password -->
    <div id="login-modal" class="fixed inset-0 z-[200] hidden items-center justify-center bg-slate-950/80 backdrop-blur-md p-4">
        <div class="bg-slate-900 border border-white/10 p-10 rounded-[2rem] w-full max-w-sm text-center shadow-2xl">
            <h3 class="text-2xl font-bold mb-6">ADMIN KEY</h3>
            <input id="login-pw" type="password" class="w-full bg-slate-800 border border-white/5 p-4 rounded-2xl mb-4 text-center tracking-[0.5em] font-black focus:border-blue-500 outline-none transition-all text-white" placeholder="â€¢â€¢â€¢â€¢">
            <button onclick="checkAdminKey()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold hover:bg-blue-500 transition-all">ì ‘ì†í•˜ê¸°</button>
            <button onclick="closeModal('login-modal')" class="w-full py-2 text-slate-500 mt-4 text-sm hover:text-slate-300">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- Player Modal -->
    <div id="player-modal" class="fixed inset-0 z-[200] hidden flex items-center justify-center bg-black/95 backdrop-blur-xl p-0 md:p-6" onclick="if(event.target === this) closePlayer()">
        <div id="player-container" class="w-full max-w-6xl bg-black md:rounded-[2.5rem] overflow-hidden shadow-[0_0_50px_rgba(0,0,0,0.5)] relative scale-95 opacity-0 transition-all duration-300 border border-white/5">
            <!-- Top Bar -->
            <div class="absolute top-0 left-0 right-0 p-6 flex justify-between items-center z-20 bg-gradient-to-b from-black/80 to-transparent">
                <div>
                    <h2 id="player-title" class="text-white font-bold text-lg md:text-xl drop-shadow-md">ì˜ìƒ ì œëª©</h2>
                    <p id="player-info" class="text-white/60 text-xs md:text-sm mt-0.5">ë¶„ë¥˜ Â· ì‘ì„±ì</p>
                </div>
                <button onclick="closePlayer()" class="w-12 h-12 bg-white/10 hover:bg-white/20 backdrop-blur-md text-white rounded-full flex items-center justify-center transition-all">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <!-- Video Iframe -->
            <div class="w-full aspect-video bg-black flex items-center justify-center relative group">
                <iframe 
                    id="player-iframe" 
                    class="w-full h-full pointer-events-auto" 
                    src="" 
                    frameborder="0" 
                    allow="autoplay; fullscreen; picture-in-picture" 
                    allowfullscreen>
                </iframe>
                <!-- ì˜¤ë²„ë ˆì´ ì•ˆë‚´ (ì„ íƒì‚¬í•­) -->
                <div id="autoplay-hint" class="absolute bottom-10 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-full text-xs font-bold animate-pulse pointer-events-none hidden">
                    ì†Œë¦¬ë¥¼ ì¼œë ¤ë©´ ì˜ìƒ í•˜ë‹¨ ìŠ¤í”¼ì»¤ ì•„ì´ì½˜ì„ ëˆ„ë¥´ì„¸ìš”
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAjbApqAPhrZXcnR2P_xd-nvrZOvZp67CI",
            authDomain: "octopath-85851.firebaseapp.com",
            projectId: "octopath-85851",
            storageBucket: "octopath-85851.firebasestorage.app",
            messagingSenderId: "744016190979",
            appId: "1:744016190979:web:fbc5badeda2e24f5f47836",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        window.allVideos = [];
        let currentCat = 'ì „ì²´';

        window.onload = async () => {
            await signInAnonymously(auth);
            fetchVideos();
            lucide.createIcons();
        };

        function fetchVideos() {
            const vRef = collection(db, 'artifacts', 'oktube-drive-v1', 'public', 'data', 'videos');
            onSnapshot(vRef, (snap) => {
                window.allVideos = snap.docs.map(doc => ({id: doc.id, ...doc.data()}))
                                .sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                render();
            });
        }

        function render() {
            const grid = document.getElementById('video-grid');
            const filtered = currentCat === 'ì „ì²´' ? window.allVideos : window.allVideos.filter(v => v.category === currentCat);
            
            if(filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-40 text-center text-slate-500">ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }

            grid.innerHTML = filtered.map(v => `
                <div class="video-card rounded-[2rem] overflow-hidden cursor-pointer" onclick='window.openPlayer(${JSON.stringify(v).replace(/'/g, "&apos;")})'>
                    <div class="aspect-video bg-slate-800 relative overflow-hidden">
                        <img src="${v.thumbnail || ''}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity">
                        <div class="absolute inset-0 bg-black/20 flex items-center justify-center">
                            <div class="w-12 h-12 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20">
                                <i data-lucide="play" fill="white" class="w-5 h-5 text-white ml-0.5"></i>
                            </div>
                        </div>
                        <div class="absolute top-3 left-3 bg-blue-600/90 text-[10px] font-bold px-3 py-1 rounded-full shadow-lg">
                            ${v.author}
                        </div>
                    </div>
                    <div class="p-4 md:p-5">
                        <p class="text-blue-400 text-[11px] font-bold mb-1">${v.category}</p>
                        <h3 class="font-bold text-sm md:text-base text-slate-200 line-clamp-1">${v.title}</h3>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        window.openPlayer = (video) => {
            const modal = document.getElementById('player-modal');
            const container = document.getElementById('player-container');
            const iframe = document.getElementById('player-iframe');
            const hint = document.getElementById('autoplay-hint');

            document.getElementById('player-title').innerText = video.title;
            document.getElementById('player-info').innerText = `${video.category} Â· ${video.author}`;

            // 1. ë“œë¼ì´ë¸Œ URLì—ì„œ IDë§Œ ì •í™•íˆ ì¶”ì¶œ
            const fileIdMatch = video.url.match(/\/d\/([a-zA-Z0-9_-]+)/);
            const fileId = fileIdMatch ? fileIdMatch[1] : "";
            
            // 2. ì„ë² ë“œ ì£¼ì†Œ êµ¬ì„± (ëª¨ë“  ê¶Œí•œ í—ˆìš© íŒŒë¼ë¯¸í„° ì¶”ê°€)
            // êµ¬ê¸€ ë“œë¼ì´ë¸Œ ë¯¸ë¦¬ë³´ê¸° ì£¼ì†ŒëŠ” ë³„ë„ì˜ API í˜¸ì¶œ ì—†ì´ iframeì—ì„œ ë°”ë¡œ ë Œë”ë§ ê°€ëŠ¥í•©ë‹ˆë‹¤.
            iframe.src = `https://drive.google.com/file/d/${fileId}/preview`;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            setTimeout(() => {
                container.classList.replace('scale-95', 'scale-100');
                container.classList.replace('opacity-0', 'opacity-100');
            }, 50);

            // ìë™ì¬ìƒ ì‹œ ì†Œë¦¬ ê´€ë ¨ ì•ˆë‚´ í‘œì‹œ (3ì´ˆ ë’¤ ì‚¬ë¼ì§)
            hint.classList.remove('hidden');
            setTimeout(() => hint.classList.add('hidden'), 5000);

            document.body.style.overflow = 'hidden';
        };

        window.closePlayer = () => {
            const modal = document.getElementById('player-modal');
            const container = document.getElementById('player-container');
            const iframe = document.getElementById('player-iframe');
            
            container.classList.replace('scale-100', 'scale-95');
            container.classList.replace('opacity-100', 'opacity-0');
            
            setTimeout(() => {
                iframe.src = "";
                modal.classList.replace('flex', 'hidden');
                document.body.style.overflow = '';
            }, 300);
        };

        window.filterCat = (cat) => {
            currentCat = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.toggle('active', b.innerText === cat));
            render();
        };

        window.openAdminLogin = () => document.getElementById('login-modal').classList.remove('hidden');
        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
        window.checkAdminKey = () => {
            const key = document.getElementById('login-pw').value;
            if(key === "8585") { // ì„ì‹œ ê´€ë¦¬ì í‚¤
                alert("ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™” (ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘)");
                closeModal('login-modal');
            } else {
                alert("ì˜ëª»ëœ í‚¤ì…ë‹ˆë‹¤.");
            }
        };
    </script>
</body>
</html>
